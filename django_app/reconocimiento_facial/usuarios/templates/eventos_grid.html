{% extends 'base.html' %}
{% load static %}

{% block title %}Lista de Eventos{% endblock %}

{% block extra_css %}
<style>
    #page-content-wrapper { padding: 0 !important; }
    .page-header { background: linear-gradient(90deg, #de4949, #b82020, #800000); color: white; padding: 30px 40px; margin: 0; box-shadow: 0 4px 15px rgba(222, 73, 73, 0.3); }
    .page-header h1 { margin: 0; font-size: 2rem; font-weight: 600; color: white; }
    .content-wrapper { padding: 30px 40px; }
    .btn-create { background: linear-gradient(90deg, #de4949, #b82020, #800000); color: white; border: none; border-radius: 10px; padding: 12px 25px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 10px rgba(222, 73, 73, 0.3); }
    .btn-create:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(222, 73, 73, 0.4); color: white; }
    .card { transition: transform 0.3s ease, box-shadow 0.3s ease; border: none; border-radius: 15px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(222, 73, 73, 0.2); }
    .card-header { background: linear-gradient(90deg, #de4949, #b82020, #800000); color: white; border-radius: 15px 15px 0 0 !important; padding: 15px 20px; }
    .card-title { margin: 0; font-weight: 600; font-size: 1.3rem; }
    .empty-state { text-align: center; padding: 60px 20px; color: #6c757d; }
    .empty-state i { font-size: 4rem; margin-bottom: 20px; opacity: 0.3; }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="bi bi-calendar-event"></i> Lista de Eventos</h1>
</div>

<div class="content-wrapper">
    <div class="mb-3">
        <form method="GET" class="row g-3 align-items-center">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" name="search" class="form-control" placeholder="Buscar por Nombre de Evento" value="{{ search_query }}" autofocus>
                    {% if year_selected %}<input type="hidden" name="year" value="{{ year_selected }}">{% endif %}
                    {% if month_selected %}<input type="hidden" name="month" value="{{ month_selected }}">{% endif %}
                    <button type="submit" class="btn btn-primary">Buscar</button>
                    {% if search_query %}
                    <a href="{% url 'listar_eventos' %}{% if year_selected or month_selected %}?{% if year_selected %}year={{ year_selected }}{% endif %}{% if year_selected and month_selected %}&{% endif %}{% if month_selected %}month={{ month_selected }}{% endif %}{% endif %}" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> Limpiar
                    </a>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <form method="GET" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label"><i class="bi bi-calendar3"></i> A침o</label>
                    <select name="year" class="form-select" onchange="this.form.submit()">
                        <option value="">Todos los a침os</option>
                        {% for yd in available_years %}<option value="{{ yd.year }}" {% if year_selected == yd.year|add:0 %}selected{% endif %}>{{ yd.year }} ({{ yd.count }})</option>{% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label"><i class="bi bi-calendar-month"></i> Mes</label>
                    <select name="month" class="form-select" onchange="this.form.submit()">
                        <option value="">Todos los meses</option>
                        {% for mes in available_months %}<option value="{{ mes.num }}" {% if month_selected == mes.num %}selected{% endif %}>{{ mes.nombre }} ({{ mes.count }})</option>{% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    {% if year_selected or month_selected %}<a href="{% url 'listar_eventos' %}" class="btn btn-outline-secondary"><i class="bi bi-x-circle"></i> Limpiar filtros</a>{% endif %}
                </div>
            </form>
        </div>
        <div>
            <a href="{% url 'crear_evento' %}" class="btn btn-create"><i class="bi bi-plus-circle"></i> Crear Evento</a>
        </div>
    </div>

    {% if lista_eventos_completa %}
    <div class="row">
        {% for evento in lista_eventos_completa %}
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header"><h5 class="card-title">{{ evento.nombre }}</h5></div>
                <div class="card-body">
                    <p><strong>Fecha:</strong> {{ evento.fecha }}</p>
                    <p><strong>Horario:</strong> {{ evento.hora_inicio }} - {{ evento.hora_fin }}</p>
                    <p><strong>Ubicaci칩n:</strong> {{ evento.ubicacion }}</p>
                    <p><strong>Relator:</strong> {{ evento.relator }}</p>
                    <p><strong>Descripci칩n:</strong> {{ evento.descripcion }}</p>
                    <p><strong>Estado:</strong>
                        {% if evento.estado == 'pendiente' %}<span class="badge bg-primary"><i class="bi bi-clock"></i> Pendiente</span>{% elif evento.estado == 'activo' %}<span class="badge bg-success"><i class="bi bi-check-circle"></i> Activo</span>{% else %}<span class="badge bg-secondary"><i class="bi bi-x-circle"></i> Finalizado</span>{% endif %}
                    </p>
                    <div class="btn-group" role="group">
                        <a href="{% url 'descargar_planilla_evento' evento.id %}" class="btn btn-success btn-sm"><i class="bi bi-download"></i> Descargar Planilla</a>
                        <a href="{% url 'editar_evento' evento.id %}" class="btn btn-primary btn-sm"><i class="bi bi-pencil"></i> Editar</a>
                        <a href="{% url 'eliminar_evento' evento.id %}" class="btn btn-danger btn-sm"><i class="bi bi-trash"></i> Eliminar</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="bi bi-calendar-x"></i>
        <h4>No hay eventos disponibles</h4>
        <p class="text-muted">No hay eventos en este momento.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
